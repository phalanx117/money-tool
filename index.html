<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>‰∏°ÊõøË®àÁÆó„ÉÑ„Éº„É´</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #2980b9;
            --success: #27ae60;
            --danger: #c0392b;
            --warning: #f39c12;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text-sub: #7f8c8d;
        }

        * { box-sizing: border-box; touch-action: manipulation; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: #333;
            margin: 0;
            padding: 0;
            /* 100vh„Å†„Å®„Ç¢„Éâ„É¨„Çπ„Éê„ÉºÂàÜ„Åö„Çå„Çã„Åì„Å®„Åå„ÅÇ„Çã„ÅÆ„Åßdvh(„ÉÄ„Ç§„Éä„Éü„ÉÉ„ÇØ)„Çí‰Ωø„ÅÜ */
            height: 100vh;
            height: 100dvh; 
            overflow: hidden; 
        }

        /* --- „Éò„ÉÉ„ÉÄ„Éº --- */
        .header-panel {
            position: fixed; top: 0; left: 0; right: 0;
            background: var(--card);
            padding: max(15px, env(safe-area-inset-top)) 20px 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 50;
        }

        .target-wrapper {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin-bottom: 10px;
        }
        .target-label { font-size: 0.8rem; color: var(--text-sub); font-weight: bold; }
        .target-val { 
            font-size: 1.8rem; font-weight: bold; color: var(--primary); 
            border-bottom: 2px solid #ddd; padding: 0 10px; min-width: 120px; text-align: right;
        }
        .target-val.active { border-color: var(--accent); background: #eef7ff; }

        .status-bar {
            background: #eee; border-radius: 8px; padding: 10px 15px;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: bold; font-size: 0.95rem; transition: background 0.3s;
        }
        .status-match { background: #d4edda; color: #155724; }
        .status-over { background: #f8d7da; color: #721c24; }
        .status-under { background: #fff3cd; color: #856404; }

        /* --- „É™„Çπ„Éà„Ç®„É™„Ç¢ --- */
        .list-area {
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 15px;
            padding-top: 170px; 
            
            /* „Äê‰øÆÊ≠£„Äë„Åì„Åì„Çí„Ç¨„ÉÉ„ÉÑ„É™Â¢ó„ÇÑ„Åó„Åæ„Åó„ÅüÔºà120px -> 300pxÔºâ */
            padding-bottom: 300px; 
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            border: 2px solid #eee;
            transition: all 0.2s;
            position: relative;
        }

        .card.disabled {
            background-color: #f9f9f9;
            opacity: 0.6;
            border-color: #eee;
        }

        .card.locked {
            border: 2px solid var(--warning);
            background-color: #fffcf5;
        }

        /* „Ç´„Éº„Éâ‰∏äÊÆµ */
        .card-top {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 8px;
        }
        
        .card-info { display: flex; align-items: center; gap: 8px; }
        
        .chk-input {
            width: 20px; height: 20px;
            accent-color: var(--accent);
            cursor: pointer;
        }
        .chk-input:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* „É≠„ÉÉ„ÇØ„Éú„Çø„É≥ */
        .btn-lock {
            background: white; border: 1px solid #ccc;
            border-radius: 4px; padding: 4px 8px;
            font-size: 0.75rem; color: #aaa; cursor: pointer;
            display: flex; align-items: center; gap: 4px;
            transition: all 0.2s;
        }
        .btn-lock.active {
            background: var(--warning); border-color: var(--warning); color: white;
            font-weight: bold; box-shadow: 0 2px 5px rgba(243, 156, 18, 0.3);
        }

        .denom-name { font-size: 1.2rem; font-weight: bold; color: var(--primary); }
        .denom-badge { 
            font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; 
            border: 1px solid #ccc; background: #f9f9f9; color: #666;
        }
        
        .count-area { text-align: right; }
        
        .subtotal-display {
            font-size: 1rem; font-weight: bold; color: var(--accent);
            margin-bottom: 2px;
        }

        .current-count {
            font-size: 1.4rem; font-weight: bold; color: var(--primary);
        }
        .current-unit { font-size: 0.8rem; color: var(--text-sub); margin-left: 2px; }

        /* „Ç´„Éº„Éâ‰∏ãÊÆµÔºö„Éú„Çø„É≥ */
        .btn-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 8px;
        }

        .ctrl-btn {
            border: none; border-radius: 8px;
            padding: 10px 0; font-weight: bold; font-size: 0.9rem;
            cursor: pointer; position: relative;
            box-shadow: 0 2px 0 rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .ctrl-btn:active { transform: translateY(2px); box-shadow: none; }

        .btn-reset { background: #f95b5b; color: #000000; font-size: 0.85rem; }
        .btn-minus { background: #fff; border: 1px solid #ddd; color: var(--danger); }
        
        .btn-plus-1 { background: #fff; border: 2px solid var(--accent); color: var(--accent); }
        .btn-plus-10 { background: var(--accent); color: white; border: 2px solid var(--accent); }
        
        .is-coin .btn-plus-1 { border-color: #e67e22; color: #e67e22; }
        .is-coin .btn-plus-10 { background: #e67e22; border-color: #e67e22; }

        /* --- „Éï„ÉÉ„Çø„Éº --- */
        .footer {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255,255,255,0.98);
            padding: 15px;
            padding-bottom: max(30px, env(safe-area-inset-bottom));
            border-top: 1px solid #ddd;
            display: flex; gap: 10px; z-index: 50;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        .main-btn {
            flex: 1; padding: 14px;
            border: none; border-radius: 10px;
            font-size: 1.1rem; font-weight: bold; color: white;
            background: var(--primary); box-shadow: 0 4px 0 #1a252f;
        }
        .main-btn:active { transform: translateY(4px); box-shadow: none; }
        .reset-all { background: #95a5a6; box-shadow: 0 4px 0 #3e3e3e; }

        /* --- „Ç≠„Éº„Éë„ÉÉ„Éâ --- */
        .keypad-overlay {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: #e8ecef; padding: 15px;
            border-radius: 20px 20px 0 0;
            transform: translateY(100%); transition: transform 0.25s ease-out;
            z-index: 100; box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
            padding-bottom: max(25px, env(safe-area-inset-bottom));
        }
        .keypad-overlay.show { transform: translateY(0); }
        
        .keypad-header { display: flex; justify-content: flex-end; margin-bottom: 10px; }
        .close-keypad { background:none; border:none; color:var(--accent); font-weight:bold; font-size:1rem; padding: 5px;}

        .key-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 400px; margin: 0 auto; }
        .key-btn { background: #fff; border:none; border-radius: 12px; padding: 15px; font-size: 1.5rem; font-weight:bold; box-shadow: 0 3px 0 #ccc; }
        .key-btn:active { background: #ddd; transform: translateY(3px); box-shadow: none; }
    </style>
</head>
<body>

    <div class="header-panel">
        <div class="target-wrapper">
            <div>
                <div class="target-label">‰∏°Êõø„Åó„Åü„ÅÑÈáëÈ°ç</div>
                <div id="target-val" class="target-val" onclick="openKeypad()">0</div>
            </div>
            <div style="text-align:right;">
                <div class="target-label">ÁèæÂú®ÂêàË®à</div>
                <div id="current-total" style="font-size:1.2rem; font-weight:bold;">¬•0</div>
            </div>
        </div>
        <div id="status-bar" class="status-bar status-match">
            <span id="status-text">ÈáëÈ°ç„ÇíÂÖ•Âäõ</span>
            <span id="diff-val">¬•0</span>
        </div>
    </div>

    <div id="list-area" class="list-area"></div>

    <div class="footer">
        <button class="main-btn reset-all" onclick="resetAll()">ÂÖ®„É™„Çª„ÉÉ„Éà</button>
        <button class="main-btn" onclick="autoFill()">ÊÆã„Çä„Çí„Ç™„Éº„ÉàÈÖçÂàÜ</button>
    </div>

    <div id="keypad" class="keypad-overlay">
        <div class="keypad-header">
            <button class="close-keypad" onclick="closeKeypad()">ÂÆå‰∫Ü ‚¨á</button>
        </div>
        <div class="key-grid">
            <button class="key-btn" onclick="inputNum(7)">7</button>
            <button class="key-btn" onclick="inputNum(8)">8</button>
            <button class="key-btn" onclick="inputNum(9)">9</button>
            <button class="key-btn" onclick="inputNum(4)">4</button>
            <button class="key-btn" onclick="inputNum(5)">5</button>
            <button class="key-btn" onclick="inputNum(6)">6</button>
            <button class="key-btn" onclick="inputNum(1)">1</button>
            <button class="key-btn" onclick="inputNum(2)">2</button>
            <button class="key-btn" onclick="inputNum(3)">3</button>
            <button class="key-btn" onclick="inputNum(0)">0</button>
            <button class="key-btn" onclick="inputNum('00')">00</button>
            <button class="key-btn" style="color:var(--danger)" onclick="inputNum('del')">‚å´</button>
        </div>
    </div>

<script>
    const denominations = [
        { val: 5000, type: 'bill', name: '5,000ÂÜÜ' },
        { val: 1000, type: 'bill', name: '1,000ÂÜÜ' },
        { val: 500,  type: 'coin', name: '500ÂÜÜ' },
        { val: 100,  type: 'coin', name: '100ÂÜÜ' },
        { val: 50,   type: 'coin', name: '50ÂÜÜ' },
        { val: 10,   type: 'coin', name: '10ÂÜÜ' },
        { val: 5,    type: 'coin', name: '5ÂÜÜ' },
        { val: 1,    type: 'coin', name: '1ÂÜÜ' }
    ];

    let targetAmount = 0;
    let counts = new Array(denominations.length).fill(0);
    let checks = new Array(denominations.length).fill(true);
    let locks = new Array(denominations.length).fill(false); 

    function init() {
        const listArea = document.getElementById('list-area');
        listArea.innerHTML = '';

        denominations.forEach((d, i) => {
            const isBill = d.type === 'bill';
            const unit = isBill ? 'Êûö' : 'Êú¨';
            const cssClass = isBill ? '' : 'is-coin';
            const badgeText = isBill ? 'Á¥ôÂπ£' : 'Á°¨Ë≤® (50Êûö/Êú¨)';

            const card = document.createElement('div');
            card.id = `card-${i}`;
            card.className = `card ${cssClass}`;
            
            card.innerHTML = `
                <div class="card-top">
                    <div class="card-info">
                        <input type="checkbox" class="chk-input" id="chk-${i}" checked onchange="toggleCheck(${i})">
                        <span class="denom-name">${d.name}</span>
                        <span class="denom-badge">${badgeText}</span>
                        
                        <button class="btn-lock" id="btn-lock-${i}" onclick="toggleLock(${i})">
                            üîì Âõ∫ÂÆö
                        </button>
                    </div>
                    <div class="count-area">
                        <div id="disp-subtotal-${i}" class="subtotal-display">¬•0</div>
                        <div>
                            <span id="disp-count-${i}" class="current-count">0</span>
                            <span class="current-unit">${unit}</span>
                        </div>
                    </div>
                </div>
                <div class="btn-row">
                    <button class="ctrl-btn btn-reset" onclick="setCount(${i}, 0)">Ë®ÇÊ≠£</button>
                    <button class="ctrl-btn btn-minus" onclick="addCount(${i}, -1)">-1</button>
                    <button class="ctrl-btn btn-plus-1" onclick="addCount(${i}, 1)">+1${unit}</button>
                    <button class="ctrl-btn btn-plus-10" onclick="addCount(${i}, 10)">+10${unit}</button>
                </div>
            `;
            listArea.appendChild(card);
        });
        updateUI();
    }

    function toggleCheck(index) {
        checks[index] = document.getElementById(`chk-${index}`).checked;
        updateCardStyle(index);
    }

    function toggleLock(index) {
        locks[index] = !locks[index];
        const btn = document.getElementById(`btn-lock-${index}`);
        const chk = document.getElementById(`chk-${index}`);
        
        if (locks[index]) {
            btn.innerHTML = 'üîí Âõ∫ÂÆö‰∏≠';
            btn.classList.add('active');
            checks[index] = true;
            chk.checked = true;
            chk.disabled = true;
        } else {
            btn.innerHTML = 'üîì Âõ∫ÂÆö';
            btn.classList.remove('active');
            chk.disabled = false;
        }
        updateCardStyle(index);
    }

    function updateCardStyle(index) {
        const card = document.getElementById(`card-${index}`);
        card.classList.remove('disabled', 'locked');

        if (locks[index]) {
            card.classList.add('locked');
        } else if (!checks[index]) {
            card.classList.add('disabled');
        }
    }

    function addCount(index, delta) {
        const d = denominations[index];
        const multiplier = (d.type === 'bill') ? 1 : 50;
        let newCount = counts[index] + (delta * multiplier);
        if (newCount < 0) newCount = 0;
        counts[index] = newCount;
        updateUI();
    }

    function setCount(index, val) {
        counts[index] = val;
        updateUI();
    }

    function resetAll() {
        counts.fill(0);
        locks.fill(false); 
        
        locks.forEach((_, i) => {
            const btn = document.getElementById(`btn-lock-${i}`);
            btn.innerHTML = 'üîì Âõ∫ÂÆö';
            btn.classList.remove('active');
            
            const chk = document.getElementById(`chk-${i}`);
            chk.disabled = false;
            
            updateCardStyle(i);
        });
        
        updateUI();
    }

    function autoFill() {
        if (targetAmount === 0) return;

        let fixedTotal = 0;
        let remaining = targetAmount;
        
        for (let i = 0; i < denominations.length; i++) {
            if (locks[i]) {
                fixedTotal += counts[i] * denominations[i].val;
            }
        }
        
        remaining -= fixedTotal;

        if (remaining < 0) {
            alert("Âõ∫ÂÆö„Åó„ÅüÈáëÈ°ç„ÅåÁõÆÊ®ôÈáëÈ°ç„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„ÅôÔºÅ");
            return;
        }

        const newCounts = [...counts];

        for (let i = 0; i < denominations.length; i++) {
            if (locks[i]) continue;
            if (!checks[i]) {
                newCounts[i] = 0; 
                continue;
            }

            const d = denominations[i];

            let reserveAmount = 0;
            for (let j = i + 1; j < denominations.length; j++) {
                if (!locks[j] && checks[j]) {
                    const d_next = denominations[j];
                    if (d_next.type === 'coin') {
                        reserveAmount += d_next.val * 50;
                    } else {
                        reserveAmount += d_next.val * 10;
                    }
                }
            }

            let availableForThis = remaining - reserveAmount;
            if (availableForThis < 0) availableForThis = 0;

            if (d.type === 'bill') {
                let count = Math.floor(availableForThis / d.val);
                newCounts[i] = count;
                remaining -= count * d.val;
            } else {
                let rollVal = d.val * 50;
                let rollCount = Math.floor(availableForThis / rollVal);
                let count = rollCount * 50;
                newCounts[i] = count;
                remaining -= count * d.val;
            }
        }
        
        counts = newCounts; 
        updateUI();
    }

    function updateUI() {
        let currentTotal = 0;

        denominations.forEach((d, i) => {
            let displayVal = (d.type === 'bill') ? counts[i] : (counts[i] / 50);
            let subtotalVal = counts[i] * d.val;

            const elCount = document.getElementById(`disp-count-${i}`);
            elCount.textContent = displayVal;
            elCount.style.color = (displayVal > 0) ? 'var(--primary)' : '#ccc';
            
            const elSubtotal = document.getElementById(`disp-subtotal-${i}`);
            elSubtotal.textContent = '¬•' + subtotalVal.toLocaleString();
            elSubtotal.style.color = (subtotalVal > 0) ? 'var(--accent)' : '#ccc';

            currentTotal += subtotalVal;
        });

        document.getElementById('current-total').textContent = '¬•' + currentTotal.toLocaleString();
        document.getElementById('target-val').textContent = '¬•' + targetAmount.toLocaleString();
        
        const bar = document.getElementById('status-bar');
        const txt = document.getElementById('status-text');
        const diffEl = document.getElementById('diff-val');
        const diff = currentTotal - targetAmount;

        bar.className = 'status-bar';

        if (targetAmount === 0 && currentTotal === 0) {
            bar.classList.add('status-match');
            txt.textContent = 'ÈáëÈ°ç„ÇíÂÖ•Âäõ';
            diffEl.textContent = '';
        } else if (diff === 0) {
            bar.classList.add('status-match');
            txt.textContent = 'OK';
            diffEl.textContent = '¬±0';
        } else if (diff > 0) {
            bar.classList.add('status-over');
            txt.textContent = 'ÈÅéÂâ∞';
            diffEl.textContent = `+${diff.toLocaleString()}`;
        } else {
            bar.classList.add('status-under');
            txt.textContent = '‰∏çË∂≥';
            diffEl.textContent = `${diff.toLocaleString()}`;
        }
    }

    const keypad = document.getElementById('keypad');
    const targetValEl = document.getElementById('target-val');
    
    function openKeypad() {
        keypad.classList.add('show');
        targetValEl.classList.add('active');
    }
    function closeKeypad() {
        keypad.classList.remove('show');
        targetValEl.classList.remove('active');
    }
    function inputNum(val) {
        let s = targetAmount.toString();
        if (targetAmount === 0) s = "";
        
        if (val === 'del') {
            s = s.slice(0, -1);
            if (s === "") s = "0";
        } else if (val === '00') {
            if (s !== "" && s !== "0") s += "00";
        } else {
            if (s.length < 10) s += val;
        }
        
        targetAmount = parseInt(s);
        if (isNaN(targetAmount)) targetAmount = 0;
        updateUI();
    }
    
    init();

</script>
</body>
</html>
